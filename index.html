<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Leo Vibes ‚Äì ƒê·∫∑t ƒê·ªì U·ªëng</title>
    <style>
      :root {
        --bg: #0b0d12;
        --card: #121622;
        --muted: #8a90a0;
        --text: #eaeef7;
        --gold: #ffb300;
        --teal: #00a98a;
        --accent: #ff7a59;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui;
        color: var(--text);
        background: var(--bg);
        overflow-x: hidden;
      }
      .container {
        max-width: 980px;
        margin: 0 auto;
        padding: 28px 18px 92px;
      }

      .hero {
        padding: 24px;
        border-radius: var(--radius);
        background: linear-gradient(
          135deg,
          rgba(255, 179, 0, 0.18),
          rgba(0, 169, 138, 0.18)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: var(--shadow);
      }
      .hero h1 {
        margin: 2px 0 8px;
        font-size: 28px;
      }
      .hero p {
        margin: 0;
        color: var(--muted);
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #111;
        background: linear-gradient(90deg, #ffd34e, #ffb300);
        border-radius: 999px;
        padding: 8px 12px;
        font-weight: 700;
        text-transform: uppercase;
      }
      .badge .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 0 12px #fff, 0 0 30px #fff;
      }

      .progress {
        position: relative;
        margin: 18px 0 0;
        height: 12px;
        background: #0f1320;
        border-radius: 999px;
        overflow: hidden;
      }
      .bar {
        height: 100%;
        width: 0;
        background: linear-gradient(90deg, var(--gold), #ffd34e, #fff);
        box-shadow: 0 0 20px rgba(255, 179, 0, 0.5);
        transition: width 0.45s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .car {
        position: absolute;
        top: -18px;
        left: 0;
        height: 32px;
        transition: left 0.45s cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      .card {
        margin-top: 22px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: var(--shadow);
      }
      .q-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 800;
        margin-bottom: 12px;
      }
      .q-title .pill {
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255, 179, 0, 0.14);
        color: #ffd34e;
        border: 1px solid rgba(255, 179, 0, 0.25);
      }

      .options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .btn {
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: #0e1220;
        color: var(--text);
        padding: 12px 14px;
        border-radius: 14px;
        transition: all 0.18s ease;
        font-weight: 700;
        font-size: 14px;
      }
      .btn:hover,
      .btn:focus {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
        outline: none;
      }
      .btn.selected {
        background: linear-gradient(
          180deg,
          rgba(255, 179, 0, 0.16),
          rgba(255, 179, 0, 0.05)
        );
        border-color: rgba(255, 179, 0, 0.55);
        box-shadow: 0 0 0 2px rgba(255, 179, 0, 0.25) inset;
      }

      .footer {
        position: sticky;
        bottom: 0;
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
        padding: 12px;
        background: linear-gradient(
          180deg,
          rgba(11, 13, 18, 0),
          rgba(11, 13, 18, 0.85) 40%
        );
        backdrop-filter: blur(6px);
      }
      .cta {
        cursor: pointer;
        padding: 12px 16px;
        border-radius: 12px;
        border: 0;
        font-weight: 900;
        background: linear-gradient(90deg, var(--teal), #22e7c6);
        color: #061014;
        box-shadow: 0 10px 28px rgba(0, 169, 138, 0.35);
        transition: transform 0.12s ease;
      }
      .cta.ghost {
        background: transparent;
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: none;
      }
      .cta:disabled {
        opacity: 0.5;
        filter: grayscale(30%);
        box-shadow: none;
        cursor: not-allowed;
      }
      .cta:hover {
        transform: translateY(-1px);
      }

      .toast {
        position: fixed;
        right: 16px;
        top: 16px;
        background: #0f1424;
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text);
        padding: 12px 14px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.28s ease;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .result {
        margin-top: 24px;
        display: none;
      }
      .result.show {
        display: block;
      }
      .panel {
        background: linear-gradient(
          180deg,
          rgba(0, 169, 138, 0.08),
          rgba(255, 179, 0, 0.06)
        );
        border: 1px solid rgba(255, 255, 255, 0.12);
        padding: 16px;
        border-radius: 16px;
      }
      .kbd {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: #0d1220;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          'Liberation Mono', monospace;
        font-size: 12px;
      }

      .slide-in {
        animation: slideIn 0.28s ease both;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .price {
        opacity: 0.9;
        color: #ffd34e;
        font-weight: 800;
        font-size: 13px;
        background: rgba(255, 179, 0, 0.08);
        border: 1px solid rgba(255, 179, 0, 0.18);
        border-radius: 10px;
        padding: 4px 8px;
      }
      .qty {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: 8px;
      }
      .qty button {
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: #0e1220;
        color: var(--text);
        border-radius: 10px;
        padding: 4px 8px;
        cursor: pointer;
      }
      .voucher {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      .voucher input {
        flex: 1;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: #0e1220;
        color: var(--text);
        padding: 10px 12px;
      }
      .total {
        margin-top: 10px;
        font-weight: 900;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="hero">
        <div class="badge"><span class="dot"></span> Chill Mode: ON ü¶Å</div>
        <h1>ƒê·∫∑t ƒê·ªì U·ªëng & ƒê·ªì ƒÇn V·∫∑t - Chill cu·ªëi tu·∫ßn</h1>
        <p>
          Ch·ªçn m√≥n b·∫°n th√≠ch r·ªìi b·∫•m <b>ƒê·∫∑t</b> ƒë·ªÉ ho√†n t·∫•t. Nh·∫≠p m√£
          <span class="kbd">Chanie</span> ƒë·ªÉ ƒë∆∞·ª£c gi·∫£m gi√° <b>100%</b> ‚ú®
        </p>
        <div class="progress" aria-label="Ti·∫øn ƒë·ªô">
          <div class="bar" id="bar"></div>
          <div class="car" id="car" aria-hidden="true">üöó</div>
        </div>
      </div>

      <div id="quiz" class="card slide-in" aria-live="polite"></div>

      <div class="footer">
        <button class="cta ghost" id="reset">‚Ü∫ L√†m l·∫°i</button>
        <div style="flex: 1"></div>
        <button class="cta ghost" id="prev">‚üµ Quay l·∫°i</button>
        <button class="cta" id="next" disabled>Ti·∫øp t·ª•c ‚Üí</button>
        <button class="cta" id="finish" style="display: none">
          üõí ƒê·∫∑t m√≥n
        </button>
      </div>

      <section class="result" id="result">
        <h2>üõí X√°c nh·∫≠n ƒë∆°n h√†ng</h2>
        <div class="panel" id="summaryDeck"></div>
      </section>
    </div>

    <div class="toast" id="toast">‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin</div>

    <script>
      (function () {
        const VND = (n) => n.toLocaleString('vi-VN') + '‚Ç´';
        const $ = (s) => document.querySelector(s);
        const quiz = $('#quiz');
        const bar = $('#bar');
        const car = $('#car');
        const nextBtn = $('#next');
        const prevBtn = $('#prev');
        const finishBtn = $('#finish');
        const resetBtn = $('#reset');
        const result = $('#result');
        const summary = $('#summaryDeck');
        const toast = $('#toast');

        // ===== EmailJS Config =====
        const EMAIL_ENABLED = true;
        const EMAIL_CONFIG = {
          service: 'service_5fzh97a',
          template: 'template_3jt6jjc',
          publicKey: 'YcvYWxme0JxNruaJl',
          to: 'alobachin@gmail.com',
        };
        try {
          if (EMAIL_ENABLED && window.emailjs) {
            emailjs.init?.(EMAIL_CONFIG.publicKey);
          }
        } catch (_) {
          /* noop */
        }

        // Menu & gi√° (tham kh·∫£o)
        const PRICES = {
          drink: {
            'N∆∞·ªõc √©p cam': 45000,
            'Soda d√¢u': 42000,
            'Sinh t·ªë xo√†i': 52000,
            'S·ªØa chua H·∫° Long': 48000,
            'S·ªØa chua Ph√∫c B·ªìn t·ª≠ ƒê√°c Cam': 70000,
            'Chanh ƒë√° xay': 55000,
          },
          sizeMul: { Nh·ªè: 1, V·ª´a: 1.2, L·ªõn: 1.4 },
          snack: {
            'B√°nh tr√°ng tr·ªôn': 35000,
            'B√°nh croissant choco': 22000,
            'Panna cotta': 35000,
            Tiramisu: 38000,
            'Tr√°i c√¢y c·∫Øt': 28000,
            'Kh√¥ng ch·ªçn th√™m': 0,
          },
        };

        const QUESTIONS = [
          {
            key: 'drink',
            label: 'Ch·ªçn lo·∫°i n∆∞·ªõc y√™u th√≠ch',
            options: Object.keys(PRICES.drink),
          },
          {
            key: 'snack',
            label: 'Ch·ªçn ƒë·ªì ƒÉn v·∫∑t ƒëi k√®m',
            options: Object.keys(PRICES.snack),
          },
          { key: 'size', label: 'K√≠ch c·ª° ly', options: ['Nh·ªè', 'V·ª´a', 'L·ªõn'] },
          {
            key: 'sugar',
            label: 'M·ª©c ƒë∆∞·ªùng',
            options: ['√çt ƒë∆∞·ªùng', 'V·ª´a ng·ªçt', 'Ng·ªçt nhi·ªÅu'],
          },
          {
            key: 'ice',
            label: 'M·ª©c ƒë√°',
            options: ['Kh√¥ng ƒë√°', '√çt ƒë√°', 'Nhi·ªÅu ƒë√°'],
          },
        ];

        const STORE_KEY = 'leo_order_v3';
        let profile = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');
        let idx = clamp(
          parseInt(localStorage.getItem(STORE_KEY + '_idx') || '0', 10),
          0,
          QUESTIONS.length - 1
        );

        function clamp(n, min, max) {
          return Math.max(min, Math.min(max, n));
        }
        function save() {
          localStorage.setItem(STORE_KEY, JSON.stringify(profile));
          localStorage.setItem(STORE_KEY + '_idx', idx);
        }

        function render() {
          const q = QUESTIONS[idx];
          const saved = profile[q.key];
          quiz.classList.remove('slide-in');
          quiz.innerHTML = `
      <div class="q-title"><span class="pill">Q${idx + 1}/${
            QUESTIONS.length
          }</span><span>${q.label}</span></div>
      <div class="options" role="group" aria-label="${q.label}">
        ${q.options
          .map(
            (op) => `
          <button class="btn ${
            saved === op ? 'selected' : ''
          }" data-val="${op}" aria-pressed="${saved === op}">
            ${op}
            ${
              q.key === 'drink'
                ? `<span class='price'>${VND(PRICES.drink[op])}</span>`
                : ''
            }
            ${
              q.key === 'snack'
                ? `<span class='price'>${VND(PRICES.snack[op])}</span>`
                : ''
            }
          </button>`
          )
          .join('')}
      </div>`;
          requestAnimationFrame(() => quiz.classList.add('slide-in'));

          const options = quiz.querySelector('.options');
          options.addEventListener(
            'click',
            (e) => {
              const b = e.target.closest('.btn');
              if (!b) return;
              options.querySelectorAll('.btn').forEach((x) => {
                x.classList.remove('selected');
                x.setAttribute('aria-pressed', 'false');
              });
              b.classList.add('selected');
              b.setAttribute('aria-pressed', 'true');
              profile[q.key] = b.dataset.val;
              save();
              toastMsg(`ƒê√£ ch·ªçn: ${q.key} ‚Üí ${b.dataset.val}`);
              updateProgress();
              nextBtn.disabled = false;
              if (idx === QUESTIONS.length - 1) {
                finishBtn.disabled = !isComplete();
              }
            },
            { passive: true }
          );

          prevBtn.disabled = idx === 0;
          nextBtn.style.display = idx < QUESTIONS.length - 1 ? '' : 'none';
          finishBtn.style.display = idx === QUESTIONS.length - 1 ? '' : 'none';
          nextBtn.disabled = !profile[q.key];
          finishBtn.disabled =
            idx === QUESTIONS.length - 1 ? !profile[q.key] : !isComplete();

          updateProgress();
        }

        function gotoNext() {
          if (!profile[QUESTIONS[idx].key]) return;
          idx = clamp(idx + 1, 0, QUESTIONS.length - 1);
          save();
          render();
        }
        function isComplete() {
          return QUESTIONS.every((q) => profile[q.key]);
        }
        function updateProgress() {
          const answered = QUESTIONS.filter((q) => profile[q.key]).length;
          const pct = Math.round((answered / QUESTIONS.length) * 100);
          bar.style.width = pct + '%';
          car.style.left = `calc(${pct}% - 16px)`;
        }

        function toastMsg(msg) {
          toast.textContent = msg;
          toast.classList.add('show');
          clearTimeout(toastMsg._t);
          toastMsg._t = setTimeout(() => toast.classList.remove('show'), 1400);
        }

        function calcTotal() {
          if (!profile.drink) return 0;
          const base = PRICES.drink[profile.drink] || 0;
          const snack = PRICES.snack[profile.snack] || 0;
          const mul = PRICES.sizeMul[profile.size || 'V·ª´a'] || 1;
          return Math.round(base * mul + snack);
        }

        function sendEmail(data) {
          if (!EMAIL_ENABLED || !window.emailjs) {
            return;
          }
          try {
            emailjs
              .send(EMAIL_CONFIG.service, EMAIL_CONFIG.template, {
                to_email: EMAIL_CONFIG.to,
                name: 'Leo Order',
                time: new Date().toLocaleString(),
                message: JSON.stringify(data, null, 2),
                voucher: data.voucher || '',
              })
              .then(() => toastMsg('üìß ƒê√£ g·ª≠i ƒë∆°n v·ªÅ email!'))
              .catch((err) => toastMsg('‚ùå G·ª≠i mail th·∫•t b·∫°i'));
          } catch (err) {
            /* noop */
          }
        }

        function showResult() {
          if (!isComplete()) {
            toastMsg('‚ö†Ô∏è H√£y ch·ªçn ƒë·∫ßy ƒë·ªß c√°c m·ª•c!');
            return;
          }

          // G·ª≠i mail ngay khi b·∫•m ƒê·∫∑t (nh∆∞ y√™u c·∫ßu)
          const order = { ...profile, total: calcTotal(), voucher: '' };
          sendEmail(order);

          result.classList.add('show');

          const rows = QUESTIONS.map(
            (q) =>
              `<tr><td style="padding:6px 0; color:var(--muted)">${
                q.label
              }</td><td style="padding:6px 0"><b>${
                profile[q.key]
              }</b></td></tr>`
          ).join('');
          const subtotal = calcTotal();

          summary.innerHTML = `
      <div>
        <h3 style="margin:0 0 8px; color:var(--gold)">Chi ti·∫øt ƒë∆°n h√†ng</h3>
        <table style="width:100%; border-collapse:collapse">${rows}</table>
        <div class="voucher">
          <input id="voucher" placeholder="Nh·∫≠p m√£ gi·∫£m gi√° (v√≠ d·ª•: Chanie)"/>
          <button class="cta ghost" id="apply">√Åp d·ª•ng</button>
        </div>
        <div class="total" id="total">T·∫°m t√≠nh: ${VND(
          subtotal
        )} ‚Ä¢ Gi·∫£m gi√°: 0‚Ç´ ‚Ä¢ T·ªïng: ${VND(subtotal)}</div>
        <p style="margin-top:12px">‚úÖ ƒê√£ g·ª≠i y√™u c·∫ßu ƒë·∫∑t n∆∞·ªõc, vui l√≤ng ch·ªù trong gi√¢y l√°t ƒë·ªÉ nh√¢n vi√™n x·ª≠ l√Ω ƒë∆°n h√†ng.</p>
      </div>`;

          // Voucher apply
          const totalEl = document.getElementById('total');
          document.getElementById('apply').onclick = () => {
            const code = (
              document.getElementById('voucher').value || ''
            ).trim();
            if (!code) {
              toastMsg('H√£y nh·∫≠p m√£ gi·∫£m gi√°');
              return;
            }
            if (code.toLowerCase() === 'chanie') {
              totalEl.textContent = `T·∫°m t√≠nh: ${VND(
                subtotal
              )} ‚Ä¢ Gi·∫£m gi√°: ${VND(subtotal)} ‚Ä¢ T·ªïng: ${VND(0)}`;
              toastMsg('üéâ √Åp m√£ Chanie th√†nh c√¥ng ‚Äì Gi·∫£m 100%!');
              // G·ª≠i mail c·∫≠p nh·∫≠t n·∫øu √°p voucher
              sendEmail({ ...order, voucher: 'Chanie', total: 0 });
            } else {
              totalEl.textContent = `T·∫°m t√≠nh: ${VND(
                subtotal
              )} ‚Ä¢ Gi·∫£m gi√°: 0‚Ç´ ‚Ä¢ T·ªïng: ${VND(subtotal)}`;
              toastMsg('‚õî M√£ kh√¥ng h·ª£p l·ªá');
            }
          };

          // Th√¥ng b√°o ƒë·∫∑t ƒë∆°n gi·ªëng app
          toastMsg('üõí ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω...');
          setTimeout(
            () => toastMsg('‚úÖ X√°c nh·∫≠n: nh√¢n vi√™n ƒë√£ nh·∫≠n ƒë∆°n!'),
            1600
          );
        }

        prevBtn.onclick = () => {
          if (idx > 0) {
            idx--;
            save();
            render();
          }
        };
        nextBtn.onclick = gotoNext;
        finishBtn.onclick = showResult;
        resetBtn.onclick = () => {
          profile = {};
          idx = 0;
          save();
          result.classList.remove('show');
          render();
          updateProgress();
        };

        render();
        updateProgress();
      })();
    </script>
  </body>
</html>
